-- // LocalScript inside StarterGui

-- SERVICES
local Players = game:GetService("Players")
local StarterGui = game:GetService("StarterGui")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local LocalPlayer = Players.LocalPlayer

-- RemoteEvent to connect between all clients
local remote = ReplicatedStorage:FindFirstChild("LH_ControlEvent") or Instance.new("RemoteEvent", ReplicatedStorage)
remote.Name = "LH_ControlEvent"

-- // GUI SETUP
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "LH_ControlGUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

local Frame = Instance.new("Frame")
Frame.Size = UDim2.new(0, 320, 0, 180)
Frame.Position = UDim2.new(0.5, -160, 0.6, -90)
Frame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
Frame.BackgroundTransparency = 0.2
Frame.BorderSizePixel = 0
Frame.Active = true
Frame.Draggable = true
Frame.Parent = ScreenGui

-- Red corner lines
local function makeLine(parent, size, pos)
	local line = Instance.new("Frame")
	line.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
	line.BorderSizePixel = 0
	line.Size = size
	line.Position = pos
	line.Parent = parent
end

makeLine(Frame, UDim2.new(1, 0, 0, 2), UDim2.new(0, 0, 0, 0)) -- top
makeLine(Frame, UDim2.new(1, 0, 0, 2), UDim2.new(0, 0, 1, -2)) -- bottom
makeLine(Frame, UDim2.new(0, 2, 1, 0), UDim2.new(0, 0, 0, 0)) -- left
makeLine(Frame, UDim2.new(0, 2, 1, 0), UDim2.new(1, -2, 0, 0)) -- right

local Title = Instance.new("TextLabel")
Title.Text = "LH CONTROL PANEL"
Title.Size = UDim2.new(1, 0, 0, 30)
Title.BackgroundTransparency = 1
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.Font = Enum.Font.SourceSansBold
Title.TextSize = 20
Title.Parent = Frame

-- TextBox to enter controller username
local PlayerBox = Instance.new("TextBox")
PlayerBox.Size = UDim2.new(1, -20, 0, 30)
PlayerBox.Position = UDim2.new(0, 10, 0, 45)
PlayerBox.PlaceholderText = "Enter controller username..."
PlayerBox.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
PlayerBox.TextColor3 = Color3.fromRGB(255, 255, 255)
PlayerBox.ClearTextOnFocus = false
PlayerBox.Parent = Frame

-- TextBox to enter commands
local CommandBox = Instance.new("TextBox")
CommandBox.Size = UDim2.new(1, -20, 0, 30)
CommandBox.Position = UDim2.new(0, 10, 0, 85)
CommandBox.PlaceholderText = "Enter command (e.g. .jump)"
CommandBox.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
CommandBox.TextColor3 = Color3.fromRGB(255, 255, 255)
CommandBox.ClearTextOnFocus = false
CommandBox.Parent = Frame

-- Execute button
local ExecuteBtn = Instance.new("TextButton")
ExecuteBtn.Size = UDim2.new(1, -20, 0, 30)
ExecuteBtn.Position = UDim2.new(0, 10, 0, 125)
ExecuteBtn.Text = "Execute Command"
ExecuteBtn.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
ExecuteBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
ExecuteBtn.Font = Enum.Font.SourceSansBold
ExecuteBtn.TextSize = 18
ExecuteBtn.Parent = Frame

-- // LOCAL FUNCTIONS
local prefix = "."
local controller = nil

-- simple notification function
local function notify(title, text)
	pcall(function()
		StarterGui:SetCore("SendNotification", {
			Title = title,
			Text = text,
			Duration = 5
		})
	end)
end

-- Execute local commands
local function executeCommand(cmd)
	local char = LocalPlayer.Character
	local humanoid = char and char:FindFirstChildOfClass("Humanoid")
	if not humanoid then return end
	cmd = cmd:lower()

	if cmd == "jump" then
		humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
	elseif cmd == "sit" then
		humanoid.Sit = true
	elseif cmd == "reset" then
		humanoid.Health = 0
	end
end

-- Controller input
PlayerBox.FocusLost:Connect(function(enterPressed)
	if enterPressed then
		local plrName = PlayerBox.Text
		local target = Players:FindFirstChild(plrName)
		if target then
			controller = target
			notify("Admins", plrName .. " صار سيدك!")
		else
			notify("Admins", "Player not found.")
		end
	end
end)

-- Button execute
ExecuteBtn.MouseButton1Click:Connect(function()
	if not controller then
		notify("Error", "No controller set.")
		return
	end

	local msg = CommandBox.Text
	if msg:sub(1, #prefix) == prefix then
		local cmd = msg:sub(#prefix + 1)
		remote:FireServer(controller, cmd)
	end
end)

-- // Add floating tag above head
local function addTag(player)
	local char = player.Character or player.CharacterAdded:Wait()
	local head = char:WaitForChild("Head")
	local billboard = Instance.new("BillboardGui", head)
	billboard.Size = UDim2.new(0, 200, 0, 50)
	billboard.StudsOffset = Vector3.new(0, 3, 0)
	billboard.AlwaysOnTop = true

	local label = Instance.new("TextLabel", billboard)
	label.Size = UDim2.new(1, 0, 1, 0)
	label.BackgroundTransparency = 1
	label.Text = "LH USER | 1"
	label.TextColor3 = Color3.fromRGB(255, 0, 0)
	label.Font = Enum.Font.SourceSansBold
	label.TextSize = 16
end

-- Add tag for everyone who runs this script
addTag(LocalPlayer)
remote.OnClientEvent:Connect(function(from)
	if from ~= LocalPlayer then
		addTag(from)
	end
end)

-- Notify others this player is LH USER
remote:FireServer(LocalPlayer)
